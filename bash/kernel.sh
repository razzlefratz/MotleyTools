#!/bin/bash

# ====================================================================
#
# --------------------------------------------------------------------

IMAGE1=2.6.20-16-generic
IMAGE2=2.6.20

# ====================================================================
#
# --------------------------------------------------------------------

echo -n " old image [ ${IMAGE1} ]: "
read
if [ ! -z ${REPLY} ]; then
	IMAGE1 = ${REPLY}
fi

# ====================================================================
#
# --------------------------------------------------------------------

ln -fs config-${IMAGE1} /boot/config     
ln -fs System.map-${IMAGE1} /boot/System.map
ln -fs vmlinuz-${IMAGE1} /boot/vmlinuz    

# ====================================================================
#
# --------------------------------------------------------------------

echo -n " new image [ ${IMAGE2} ]: "
read
if [ ! -z ${REPLY} ]; then
	IMAGE2 = ${REPLY}
fi

# ====================================================================
#
# --------------------------------------------------------------------

if [ ! -d linux-${IMAGE2} ]; then
	if [ ! -f linux-${IMAGE2} ]; then
		echo "File linux-${IMAGE2}.tar.bz2 is missing or misplaced"
		exit 1
	fi
	tar -vjxf linux-${IMAGE2}.tar.bz2
fi
cd linux-${IMAGE2}

# ====================================================================
#
# --------------------------------------------------------------------

make mrproper
make oldconfig
make modules
make modules_install
make bzImage
make install

# ====================================================================
#
# --------------------------------------------------------------------

depmod -v ${IMAGE2}
if [ -f /boot/initrd.img-${IMAGE2} ]; then
	mkinitrd -o /boot/initrd.img-${IMAGE2} ${IMAGE2}
fi

